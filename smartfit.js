var height,heightgiven=!1;document.getElementById("frontfile").disabled=!0,document.getElementById("sideFile").disabled=!0,document.getElementById("backFile").disabled=!0,document.getElementById("frontfilelabel").innerHTML="Enter Height Above",document.getElementById("sidefilelabel").innerHTML="Enter Height Above",document.getElementById("backfilelabel").innerHTML="Enter Height Above";var heightEntry=document.getElementById("height");heightEntry.addEventListener("change",function(){height=document.getElementById("height").value,heightgiven=!0,document.getElementById("frontfile").disabled=!1,document.getElementById("sideFile").disabled=!1,document.getElementById("backFile").disabled=!1,document.getElementById("frontfilelabel").innerHTML="Choose Front Image",document.getElementById("sidefilelabel").innerHTML="Choose Side Image",document.getElementById("backfilelabel").innerHTML="Choose Back image"});var canvasFront=document.getElementById("mycanvas"),canvasSide=document.getElementById("mycanvasSide"),canvasBack=document.getElementById("mycanvasBack"),frontFile=document.getElementById("frontfile"),sideFile=document.getElementById("sideFile"),backFile=document.getElementById("backFile"),fitImageOn=function(e,t){var n,a,r,i,c=t.width/t.height,o=e.width/e.height,s=e.getContext("2d");c<o?(n=e.height,a=t.width*(n/t.height),r=(e.width-a)/2,i=0):c>o?(a=e.width,n=t.height*(a/t.width),r=0,i=(e.height-n)/2):(n=e.height,a=e.width,r=0,i=0),e.height,s.drawImage(t,r,i,a,n)},URL=window.webkitURL||window.URL,redrawFrontImage=new Image;redrawFrontImage.crossOrigin="anonymous";var redrawSideImage=new Image;redrawSideImage.crossOrigin="anonymous";var redrawBackImage=new Image;function handleFrontFile(e){if(1==heightgiven){var t=new FileReader,n=e.target.files[0],a=new Image;a.onload=function(){fitImageOn(canvasFront,a),recalibfirst()},t.onloadend=function(){a.src=t.result,redrawFrontImage.src=t.result},t.readAsDataURL(n)}else window.alert("Please Enter Client's Height Before Uploading Image")}function handleSideFile(e){if(1==heightgiven){var t=new FileReader,n=e.target.files[0],a=new Image;a.onload=function(){fitImageOn(canvasSide,a),recalibsecond()},t.onloadend=function(){a.src=t.result,redrawSideImage.src=t.result},t.readAsDataURL(n)}else window.alert("Please Enter Client's Height Before Uploading Image")}function handleBackFile(e){if(heightgiven){var t=new FileReader,n=e.target.files[0],a=new Image;a.onload=function(){fitImageOn(canvasBack,a),recalibthird()},t.onloadend=function(){a.src=t.result,redrawBackImage.src=t.result},t.readAsDataURL(n)}else window.alert("Please Enter Client's Height Before Uploading Image")}async function predictSegment(e,t){const n=await bodyPix.load({architecture:"MobileNetV1",outputStride:16,multiplier:.75,quantBytes:1}),a=await n.segmentPerson(e,{flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7}),r=bodyPix.toMask(a,!1);bodyPix.drawMask(t,e,r,.8,0,!1)}redrawBackImage.crossOrigin="anonymous",frontFile.addEventListener("change",handleFrontFile),sideFile.addEventListener("change",handleSideFile),backFile.addEventListener("change",handleBackFile,!1);var getcircum=!1;document.getElementById("lenorcircum").addEventListener("click",function(){getcircum=document.getElementById("lenorcircum").checked,redoFunc(),console.log(getcircum)});var measurements=[],circumArray={frontmeasure:-1,sidemeasure:-1,backmeasure:-1},tempLen=0,calib_counter=0,md=!1,contextFront=canvasFront.getContext("2d");canvasFront.addEventListener("mousedown",function(e){""!=redrawFrontImage.src?(md=!0,startpos=getMousePos(canvasFront,e),drawmarker(contextFront,startpos.x,startpos.y)):window.alert("Please Upload Front Facing Image Before Measuring")}),canvasFront.addEventListener("mouseup",function(e){if(md=!1,console.log("UP"),endpos=getMousePos(canvasFront,e),drawmarker(contextFront,endpos.x,endpos.y),draw(contextFront,startpos,endpos),0==calib_counter)dist=getDistance(startpos,endpos),scale_factor=height/dist,inches_distance=scale_factor*dist,console.log(inches_distance),window.confirm("click 'ok' if calibration was correct. Click 'cancel' to redo calibration")?(window.alert("Caliberation Complete, You can now start measuring"),setTimeout(()=>{redraw()},500),calib_counter+=1):(redraw(),calib_counter=0);else if(dist=getDistance(startpos,endpos),inches_distance=scale_factor*dist,console.log(inches_distance),tempLen=inches_distance.toFixed(2),0==getcircum)document.getElementById("templenview").innerHTML=tempLen;else if(circumArray.frontmeasure=tempLen,-1!=circumArray.sidemeasure&-1!=circumArray.backmeasure){var t=circumference(Math.max(circumArray.frontmeasure,circumArray.backmeasure)/2,circumArray.sidemeasure/2);document.getElementById("templenview").innerHTML=t}});var tempLen2=0,calib_counter2=0,md2=!1,contextSide=canvasSide.getContext("2d");canvasSide.addEventListener("mousedown",function(e){""!=redrawSideImage.src?(md2=!0,startpos=getMousePos(canvasSide,e),drawmarker(contextSide,startpos.x,startpos.y)):window.alert("Please Upload Side Facing Image Before Measuring")}),canvasSide.addEventListener("mouseup",function(e){if(md2=!1,console.log("UP"),endpos=getMousePos(canvasSide,e),drawmarker(contextSide,endpos.x,endpos.y),draw(contextSide,startpos,endpos),0==calib_counter2)dist2=getDistance(startpos,endpos),scale_factor2=height/dist2,inches_distance2=scale_factor2*dist2,console.log(inches_distance2),window.confirm("click 'ok' if calibration was correct. Click 'cancel' to redo calibration")?(window.alert("Caliberation Complete, You can now start measuring"),setTimeout(()=>{redraw()},500),calib_counter2+=1):(redraw(),calib_counter2=0);else if(dist2=getDistance(startpos,endpos),inches_distance2=scale_factor2*dist2,console.log(inches_distance2),tempLen2=inches_distance2.toFixed(2),0==getcircum)document.getElementById("templenview").innerHTML=tempLen2;else if(circumArray.sidemeasure=tempLen2,-1!=circumArray.frontmeasure&-1!=circumArray.backmeasure){var t=circumference(Math.max(circumArray.frontmeasure,circumArray.backmeasure)/2,circumArray.sidemeasure/2);document.getElementById("templenview").innerHTML=t}});var tempLen3=0,calib_counter3=0,md3=!1,contextBack=canvasBack.getContext("2d");canvasBack.addEventListener("mousedown",function(e){""!=redrawBackImage.src?(md3=!0,startpos=getMousePos(canvasBack,e),drawmarker(contextBack,startpos.x,startpos.y)):window.alert("Please Upload Side Facing Image Before Measuring")}),canvasBack.addEventListener("mouseup",function(e){if(md3=!1,console.log("UP"),endpos=getMousePos(canvasBack,e),drawmarker(contextBack,endpos.x,endpos.y),draw(contextBack,startpos,endpos),0==calib_counter3)dist3=getDistance(startpos,endpos),scale_factor3=height/dist3,inches_distance3=scale_factor3*dist3,console.log(inches_distance3),window.confirm("click 'ok' if calibration was correct. Click 'cancel' to redo calibration")?(window.alert("Caliberation Complete, You can now start measuring"),setTimeout(()=>{redraw()},500),calib_counter3+=1):(redraw(),calib_counter3=0);else if(dist3=getDistance(startpos,endpos),inches_distance3=scale_factor3*dist3,console.log(inches_distance3),tempLen3=inches_distance3.toFixed(2),0==getcircum)document.getElementById("templenview").innerHTML=tempLen3;else if(circumArray.backmeasure=tempLen3,console.log(circumArray),-1!=circumArray.sidemeasure&-1!=circumArray.frontmeasure){var t=circumference(Math.max(circumArray.frontmeasure,circumArray.backmeasure)/2,circumArray.sidemeasure/2);document.getElementById("templenview").innerHTML=t}});var measurementLabel,viewmeasures=document.getElementById("viewmeasures"),conf=document.getElementById("confirm");conf.addEventListener("click",function(){if(""!=document.getElementById("label").value)for(var e in 0==getcircum?(measurementLabel=document.getElementById("label").value,measurements.push({key:measurementLabel,value:Math.max(tempLen,tempLen2,tempLen3)}),console.log(measurements)):(measurementLabel=document.getElementById("label").value,measurements.push({key:measurementLabel,value:document.getElementById("templenview").innerHTML})),tempLen=0,tempLen2=0,tempLen3=0,circumArray={frontmeasure:-1,sidemeasure:-1,backmeasure:-1},redraw(),document.getElementById("label").value="",document.getElementById("templenview").innerHTML="",viewmeasures.innerHTML="",measurements){var t=document.createElement("Label");t.innerHTML=measurements[e].key+" : "+measurements[e].value+" inches ",viewmeasures.appendChild(t);var n=document.createElement("br");viewmeasures.appendChild(n)}else window.alert("Please Enter A Measurement Label")}),document.getElementById("deletemeasurements").addEventListener("click",function(){measurements=[],viewmeasures.innerHTML="",redoFunc()}),document.getElementById("deletelast").addEventListener("click",function(){for(var e in measurements.pop(),redoFunc(),viewmeasures.innerHTML="",measurements){var t=document.createElement("Label");t.innerHTML=measurements[e].key+" : "+measurements[e].value+" inches ",viewmeasures.appendChild(t);var n=document.createElement("br");viewmeasures.appendChild(n)}});var redo=document.getElementById("redo");function redoFunc(){tempLen=0,tempLen2=0,tempLen3=0,redraw(),circumArray={frontmeasure:-1,sidemeasure:-1,backmeasure:-1},document.getElementById("templenview").innerHTML=""}function getMousePos(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}function draw(e,t,n){e.lineWidth=2,e.strokeStyle="yellow",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}function drawmarker(e,t,n){e.fillStyle="#FF0000",e.fillRect(t,n,2,2)}function getDistance(e,t){return x_2=Math.pow(e.x-t.x,2),y_2=Math.pow(e.y-t.y,2),dist=Math.sqrt(x_2+y_2),dist}function redraw(){""!=redrawFrontImage.src?fitImageOn(canvasFront,redrawFrontImage):(contextFront.clearRect(0,0,canvasFront.width,canvasFront.height),contextFront.beginPath()),""!=redrawSideImage.src?fitImageOn(canvasSide,redrawSideImage):(contextSide.clearRect(0,0,canvasSide.width,canvasSide.height),contextSide.beginPath()),""!=redrawBackImage.src?fitImageOn(canvasBack,redrawBackImage):(contextBack.clearRect(0,0,canvasBack.width,canvasBack.height),contextBack.beginPath())}function circumference(e,t){return circum=Math.PI*(e+t)*(1+3*(e-t)**2/(e+t)**2/(10+Math.sqrt(4-3*(e-t)**2/(e+t)**2))),circum.toFixed(2)}redo.addEventListener("click",redoFunc),canvasFront.onmousemove=function(){canvasFront.style.cursor="crosshair"},canvasSide.onmousemove=function(){canvasSide.style.cursor="crosshair"},canvasBack.onmousemove=function(){canvasBack.style.cursor="crosshair"};var sendemail=document.getElementById("sendemail");sendemail.addEventListener("click",function(e){var t=document.getElementById("name").value,n=document.getElementById("emailto").value,a=document.getElementById("clientname").value,r=document.getElementById("notes").value,i="\n";for(var c in measurements)i+=measurements[c].key+" : "+measurements[c].value+" inches,\t \t\n";if(t.length>0&n.length>0){var o={to_email:n,from_name:"SmartFit",to_name:t,message:i,bcc_to:"khalid.hamdaan@gmail.com",reply_to:"khalid.hamdaan@gmail.com",clientname:a,notes:r};emailjs.send("service_0jvermk","template_ccsi35k",o).then(function(e){console.log("SUCCESS!",e.status,e.text),window.alert("The email was sent succesfully, please check junk incase it is not visible in inbox!")},function(e){console.log("FAILED...",e),window.alert("There was an error in your email, please try again.")})}else window.alert("Please fill both name and email fields")});var recalibFrontbutton=document.getElementById("calibfront"),recalibSidebutton=document.getElementById("calibSide"),recalibBackbutton=document.getElementById("calibBack");function recalibfirst(){window.alert("Please calibrate by drawing line from head to toe"),redraw(),calib_counter=0}function recalibsecond(){window.alert("Please calibrate by drawing line from head to toe"),redraw(),calib_counter2=0}function recalibthird(){window.alert("Please calibrate by drawing line from head to toe"),redraw(),calib_counter3=0}recalibFrontbutton.addEventListener("click",recalibfirst),recalibSidebutton.addEventListener("click",recalibsecond),recalibBackbutton.addEventListener("click",recalibthird);
